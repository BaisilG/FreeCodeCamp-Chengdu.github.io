<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar/dist/fullcalendar.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.7.2/css/all.min.css">
<style>
  .fc-bg, .fc-content-skeleton thead {
    color: transparent;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.24.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar/dist/fullcalendar.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar/dist/locale/zh-cn.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"></script>

<div id="Calendar"></div>

<script type="application/json">
<%-
  JSON.stringify(
    site.posts.map(post => {
      if (post.categories.data.some(item => RegExp(item.name, 'i').test(path)))
        return {
          title:  post.title,
          detail: post.description,
          url:    post.path,
          start:  post.start,
          end:    post.end
        };
    }).filter( Boolean )
  )
%>
</script>

<script>
  $('#Calendar').fullCalendar({
    themeSystem: 'bootstrap4',
    header: {
      left: 'prev,next today',
      center: 'title',
      right: 'month,agendaWeek,agendaDay'
    },
    eventLimit: true,
    events: JSON.parse(
      document.currentScript.previousElementSibling.text.trim()
    ),
    eventRender: function(eventObj, $el) {
      $el.popover({
        title: eventObj.title,
        content: eventObj.detail || '',
        trigger: 'hover',
        placement: 'top',
        container: 'body'
      });
    }
  });
</script>

<%- page.content %>
